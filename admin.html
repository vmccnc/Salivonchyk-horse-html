<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Админ-панель управления лошадьми">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админка - HorseFarm</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <header>
    <nav>
      <div class="logo">HorseFarm Admin</div>
      <ul>
        <li><a href="index.html">На главную</a></li>
        <li><a href="purchase.html">Покупка коней</a></li>
        <li><a href="admin.html" class="active">Админка</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Управление лошадьми</h1>
    <div id="admin-horses-list">
      <!-- All horses data will be displayed here -->
    </div>
  </main>

  <footer>
    <p>&copy; 2025 HorseFarm. Админка.</p>
  </footer>

  <script>
    // Fetch all horses from the backend API
    fetch('http://localhost:8090/api/horses')
      .then(response => response.json())
      .then(horses => {
        const list = document.getElementById('admin-horses-list');
        horses.forEach(horse => {
          const card = document.createElement('div');
          card.classList.add('admin-horse-card');
          let buyersInfo = "Покупателей нет.";
          // In a real app, you might fetch buyer details in a separate API call.
          if (horse.buyers && horse.buyers.length) {
            buyersInfo = horse.buyers.map(b =>
              `${b.buyerName}: $${b.amount}`).join('<br>');
          }
          card.innerHTML = `
            <h2>${horse.name}</h2>
            <p>Год рождения: ${horse.yearOfBirth}</p>
            <p>Порода: ${horse.breed}</p>
            <p>Цена: $${horse.price}</p>
            <p>Статус: ${horse.status}</p>
            <p><strong>Покупатели:</strong><br>${buyersInfo}</p>
            <button onclick="publishHorse(${horse.id})">Опубликовать</button>
          `;
          list.appendChild(card);
        });
      })
      .catch(err => console.error(err));

    function publishHorse(horseId) {
      fetch(`http://localhost:8090/api/horses/${horseId}/publish`, { method: 'PUT' })
        .then(response => response.json())
        .then(updatedHorse => {
          alert(`Лошадь ${updatedHorse.name} опубликована для продажи.`);
          location.reload();
        });
    }
  </script>
</body>
</html>
